{% extends 'base.html' %}
{% load static %}

{% block title %}Payment - {{ tournament.name }}{% endblock %}

{% block content %}
<!-- Full Screen Background Image -->
<div 
    class="fixed inset-0 w-full h-full z-0"
    style="background-image: url('{% static 'images/bg2.png' %}'); background-size: cover; background-position: center; background-repeat: no-repeat;"
></div>

<!-- Overlay -->
<div class="fixed inset-0 z-0 bg-black/70"></div>

<style>
    .payment-container {
        max-width: 900px;
        margin: 2rem auto;
        padding: 2rem;
    }
    
    .payment-card {
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(249, 115, 22, 0.3);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }
    
    .tournament-info {
        background: linear-gradient(135deg, rgba(249, 115, 22, 0.2) 0%, rgba(234, 88, 12, 0.2) 100%);
        border: 2px solid rgba(249, 115, 22, 0.4);
        backdrop-filter: blur(10px);
        color: white;
        padding: 1.5rem;
        border-radius: 15px;
        margin-bottom: 2rem;
    }
    
    .amount-display {
        font-size: 3.5rem;
        font-weight: bold;
        text-align: center;
        background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 2rem 0;
        text-shadow: 0 0 30px rgba(249, 115, 22, 0.5);
        filter: drop-shadow(0 0 10px rgba(249, 115, 22, 0.3));
    }
    
    .payment-method-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin: 2rem 0;
    }
    
    .method-card {
        border: 2px solid rgba(75, 85, 99, 0.5);
        background: rgba(17, 24, 39, 0.8);
        backdrop-filter: blur(5px);
        border-radius: 15px;
        padding: 2rem 1.5rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .method-card:hover {
        border-color: rgba(249, 115, 22, 0.8);
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(249, 115, 22, 0.3);
        background: rgba(249, 115, 22, 0.1);
    }
    
    .method-card.selected {
        border-color: #f97316;
        background: linear-gradient(135deg, rgba(249, 115, 22, 0.2) 0%, rgba(234, 88, 12, 0.2) 100%);
        box-shadow: 0 10px 30px rgba(249, 115, 22, 0.4);
        transform: scale(1.05);
    }
    
    .method-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
    }
    
    .method-name {
        font-weight: 600;
        font-size: 1.1rem;
        color: #f3f4f6;
    }
    
    .proceed-btn {
        width: 100%;
        padding: 1rem 2rem;
        background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1.2rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 2rem;
        box-shadow: 0 4px 15px rgba(249, 115, 22, 0.4);
    }
    
    .proceed-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(249, 115, 22, 0.5);
    }
    
    .proceed-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
    }
    
    .info-box {
        background: rgba(59, 130, 246, 0.1);
        border: 2px solid rgba(59, 130, 246, 0.3);
        backdrop-filter: blur(5px);
        padding: 1rem;
        border-radius: 12px;
        margin-top: 2rem;
    }
    
    .info-box i {
        color: #3b82f6;
        margin-right: 0.5rem;
    }
    
    .info-box p {
        color: #e5e7eb;
        margin: 0;
    }
</style>

<div class="relative z-10 payment-container">
    <div class="payment-card">
        <!-- Tournament Info Header -->
        <div class="tournament-info">
            <h1 style="font-size: 2rem; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-trophy" style="color: #f97316;"></i> {{ tournament.name }}
            </h1>
            <p style="opacity: 0.9; font-size: 1rem; display: flex; align-items: center; gap: 0.5rem; margin: 0;">
                <i class="fas fa-gamepad" style="color: #f97316;"></i> {{ tournament.get_category_display }}
            </p>
        </div>
        
        <!-- Amount Display -->
        <div>
            <h2 style="text-align: center; color: #9ca3af; margin-bottom: 0.5rem; font-size: 1rem; text-transform: uppercase; letter-spacing: 2px;">Entry Fee</h2>
            <div class="amount-display">
                à§³{{ tournament.price }}
            </div>
        </div>
        
        <!-- Payment Method Selection -->
        <div>
            <h3 style="color: #f3f4f6; margin-bottom: 1.5rem; font-size: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-credit-card" style="color: #f97316;"></i> Select Payment Method
            </h3>
            
            <form method="post" action="{% url 'initiate_payment' tournament.id %}" id="paymentForm">
                {% csrf_token %}
                
                <div class="payment-method-grid">
                    <!-- bKash -->
                    <div class="method-card" onclick="selectMethod('bkash', this)">
                        <div class="method-icon" style="color: #E2136E;">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <div class="method-name">bKash</div>
                        <input type="radio" name="payment_method" value="bkash" style="display: none;">
                    </div>
                    
                    <!-- Nagad -->
                    <div class="method-card" onclick="selectMethod('nagad', this)">
                        <div class="method-icon" style="color: #F47920;">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <div class="method-name">Nagad</div>
                        <input type="radio" name="payment_method" value="nagad" style="display: none;">
                    </div>
                    
                    <!-- Rocket -->
                    <div class="method-card" onclick="selectMethod('rocket', this)">
                        <div class="method-icon" style="color: #8B3A9B;">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <div class="method-name">Rocket</div>
                        <input type="radio" name="payment_method" value="rocket" style="display: none;">
                    </div>
                    
                    <!-- Card -->
                    <div class="method-card" onclick="selectMethod('card', this)">
                        <div class="method-icon" style="color: #667eea;">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <div class="method-name">Credit/Debit Card</div>
                        <input type="radio" name="payment_method" value="card" style="display: none;">
                    </div>
                    
                    <!-- Manual -->
                    <div class="method-card" onclick="selectMethod('manual', this)">
                        <div class="method-icon" style="color: #10b981;">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <div class="method-name">Manual Transfer</div>
                        <input type="radio" name="payment_method" value="manual" style="display: none;">
                    </div>
                </div>
                
                <button type="submit" class="proceed-btn" id="proceedBtn" disabled>
                    <i class="fas fa-arrow-right"></i> Proceed to Payment
                </button>
            </form>
        </div>
        
        <!-- Info Box -->
        <div class="info-box">
            <p>
                <i class="fas fa-info-circle"></i>
                <strong style="color: #60a5fa;">Note:</strong> After selecting your payment method, you will receive payment instructions. 
                Please complete the payment and enter your transaction details on the next page. The host will verify your payment before approving your entry.
            </p>
        </div>
        
        <!-- Back Link -->
        <div style="text-align: center; margin-top: 1.5rem;">
            <a href="{% url 'public_tournaments' %}" style="color: #9ca3af; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#f97316'" onmouseout="this.style.color='#9ca3af'">
                <i class="fas fa-arrow-left"></i> Back to Tournaments
            </a>
        </div>
    </div>
</div>

<script>
    function selectMethod(method, card) {
        // Remove selected class from all cards
        document.querySelectorAll('.method-card').forEach(c => {
            c.classList.remove('selected');
        });
        
        // Add selected class to clicked card
        card.classList.add('selected');
        
        // Check the corresponding radio button
        card.querySelector('input[type="radio"]').checked = true;
        
        // Enable proceed button
        document.getElementById('proceedBtn').disabled = false;
    }
    
    // Prevent form submission if no method selected
    document.getElementById('paymentForm').addEventListener('submit', function(e) {
        const selected = document.querySelector('input[name="payment_method"]:checked');
        if (!selected) {
            e.preventDefault();
            alert('Please select a payment method');
        }
    });
</script>
{% endblock %}
