{% extends 'base.html' %}
{% load static %}

{% block title %}TournifyX | Home{% endblock %}

{% block extra_css %}
<style>
  html, body { height: 100%; margin: 0; padding: 0; overflow: auto; }
  /* Floating X styles */
  #floatingXs { pointer-events: none; z-index: 9999; }
  .floating-x {
    position: absolute;
    color: #fff;
    font-weight: 700;
    font-size: 14px;
    line-height: 1;
    user-select: none;
    opacity: 0;
    will-change: transform, opacity;
    transform: translateX(var(--drift,0)) translateY(0) rotate(var(--rot,0deg));
    animation-name: floatX;
    animation-fill-mode: forwards;
  }

  /* Play overlay/button shown when autoplay is blocked or user needs to start playback */
  #videoPlayOverlay { background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.45)); }
  .play-button {
    width: 92px;
    height: 92px;
    border-radius: 9999px;
    background: rgba(255,255,255,0.06);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    border: 1px solid rgba(255,255,255,0.08);
  }

  @keyframes floatX {
    0% { opacity: 1; transform: translateX(var(--drift,0)) translateY(0) rotate(0deg); }
    100% { opacity: 0; transform: translateX(calc(var(--drift,0) + 20px)) translateY(-140px) rotate(360deg); }
  }

  /* Right side long image (hidden until video ends) */
  #sideLongImage {
    position: fixed;
    right: calc(24px + 0.5in); /* move 2 inches more to the right */
    top: 2vh;
    height: 105vh;
    max-width: 60vw;
    width: auto;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: none;
    transform: translateX(0) scale(1.22); /* bigger */
    opacity: 0;
    transition: opacity 550ms ease-out, transform 550ms ease-out, right 550ms ease-out, height 550ms ease-out, max-width 550ms ease-out;
    z-index: 55;
    pointer-events: none;
    animation: floatOmen 3.5s ease-in-out infinite;
  }

  @keyframes floatOmen {
    0% { transform: translateX(0) scale(1.22) translateY(0); }
    50% { transform: translateX(0) scale(1.22) translateY(-24px); }
    100% { transform: translateX(0) scale(1.22) translateY(0); }
  }
  #sideLongImage.show { 
    transform: translateX(0) scale(1.13); /* still bigger when shown */
    opacity: 1; 
  }
  #sideLongImage.hide-on-bg { opacity: 0 !important; pointer-events: none; }
</style>
{% endblock %}

{% block extra_debug %}
<script>
  (function(){
    const v = document.getElementById('heroVideo');
    if (!v) return;
    try {
      v.playbackRate = 2;
      const srcs = Array.from(v.querySelectorAll('source')).map(s => s.src);
      console.log('Hero video element found. Sources:', srcs);

      // Try to play and report error if any
      v.play().then(() => {
        console.log('Hero video playback started successfully.');
      }).catch(err => {
        console.error('Hero video play() failed:', err);
        // show a small non-blocking message on the page
        let msg = document.getElementById('videoErrorMsg');
        if (!msg) {
          msg = document.createElement('div');
          msg.id = 'videoErrorMsg';
          msg.style.position = 'fixed';
          msg.style.bottom = '12px';
          msg.style.left = '12px';
          msg.style.padding = '8px 12px';
          msg.style.background = 'rgba(0,0,0,0.6)';
          msg.style.color = '#fff';
          msg.style.zIndex = '100000';
          msg.style.borderRadius = '6px';
          msg.style.fontSize = '13px';
          msg.textContent = 'Video failed to autoplay — open DevTools Console to see details.';
          document.body.appendChild(msg);
        }
        // show the play overlay so user can start the video manually
        const overlay = document.getElementById('videoPlayOverlay');
        if (overlay) {
          overlay.classList.remove('hidden');
        }
      });
    } catch (e) {
      console.error('Error while testing hero video:', e);
    }
  })();
</script>
{% endblock %}

{% block content %}
<!-- Background Video -->
<div id="videoWrapper" class="fixed inset-0 z-0">
  <video id="heroVideo" class="w-full h-full object-cover brightness-[.7] contrast-110" autoplay muted playsinline poster="{% static 'images/background.jpg' %}">

    <source src="{% static 'videos/bgvid.mp4' %}" type="video/mp4">
    <!-- fallback text -->
    Your browser does not support the video tag.
  </video>
  <!-- Semi-opaque overlay that applies only to the video area -->
  <div id="videoOverlay" class="absolute inset-0 bg-black/50 pointer-events-none transition-opacity duration-500"></div>

  <!-- Play overlay: hidden by default, shown if autoplay is blocked or user taps to start -->
  <div id="videoPlayOverlay" class="hidden absolute inset-0 z-40 flex items-center justify-center pointer-events-auto">
    <button id="playBtn" class="play-button text-white flex items-center justify-center shadow-lg">
      <svg width="54" height="54" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M5 3v18l15-9L5 3z"/></svg>
    </button>
  </div>
</div>
<!-- Background image that will fade in after the video ends -->
<div id="heroBg" class="fixed top-0 left-0 w-full h-full z-0 opacity-0 transition-opacity duration-700 ease-out bg-center bg-cover" style="background-image: url('{% static 'images/bg.png' %}');"></div>
<!-- Right-side long image (hidden initially, shows on video end) -->
<div id="sideLongImage" aria-hidden="true">
  <img src="{% static 'images/omen.png' %}" alt="" class="w-full h-full object-cover">
</div>
<div class="fixed top-0 left-0 w-full h-full z-10 pointer-events-none "></div>

<!-- Container for floating X elements (high z so visible above static backgrounds) -->
<div id="floatingXs" class="fixed inset-0 z-60 pointer-events-none"></div>

<!-- Floating Nav (top-right) -->
<div class="fixed top-0 left-0 w-full z-20 pointer-events-none">
  <div class="flex justify-end items-center pt-10 pr-16 w-full">
    <a href="#" class="pointer-events-auto bg-white text-gray-900 font-bold rounded-full px-8 py-3 text-base shadow-lg flex items-center gap-2 border-none hover:bg-gray-100 transition">
      Watch Live Stream
      <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M5 12h14M13 18l6-6-6-6"/></svg>
    </a>
  </div>
</div>

<div class="relative z-20 h-screen flex flex-col justify-between">
  <!-- Left-aligned: Logo (repositionable), Heading, and Buttons -->
  <div class="absolute top-1/2 left-[7vw] -translate-y-[80%] z-30 flex flex-col items-start">
    <!-- Adjust the Tailwind classes below to reposition the logo as you like -->
    <div class="mb-6">
      <img src="{% static 'images/logo.png' %}" alt="TournifyX Logo" class="w-28 h-28 drop-shadow-xl" />
    </div>
    <h1 class="text-white text-5xl md:text-7xl font-extrabold uppercase tracking-widest leading-tight drop-shadow-lg mb-8 text-left">
      WELCOME TO<br>TOURNIFYX
    </h1>
    <div class="flex gap-6">
      <a href="{% url 'join_tournament' %}" class="bg-white/20 text-white border-2 border-white/30 rounded-full text-lg font-bold px-8 py-3 shadow-md hover:bg-orange-600 hover:text-white hover:border-orange-600 transition backdrop-blur-sm float-on-hover">Join a tournament</a>
      <a href="{% url 'host_tournament' %}" class="bg-white/20 text-white border-2 border-white/30 rounded-full text-lg font-bold px-8 py-3 shadow-md hover:bg-orange-600 hover:text-white hover:border-orange-600 transition backdrop-blur-sm float-on-hover">Create a tournament</a>
    </div>
  </div>

  <!-- Bottom-Center: Scroll Indicator -->
  <div class="fixed left-1/2 bottom-2 md:bottom-4 -translate-x-1/2 z-40 flex flex-col items-center opacity-85">
    <a href="#esports-games">
      <svg width="32" height="32" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
    </a>
  </div>
</div>

<!-- Additional full-screen background section revealed when scrolling down -->
<section id="bg" class="relative w-full min-h-screen bg-center bg-cover bg-no-repeat flex items-center justify-center" style="background-image: url('{% static 'images/bg2.png' %}');">
  <div class="absolute inset-0 bg-transparent"></div>
  <div class="relative z-10 text-center text-white p-8">
    <h2 class="text-4xl md:text-5xl font-extrabold mb-4">Explore More</h2>
    <p class="max-w-3xl mx-auto text-lg md:text-xl">This is a placeholder section — replace with additional homepage content later.</p>
  </div>
</section>

<!-- New section: Most Promising Esports Games -->
<section id="esports-games" class="relative w-full min-h-screen bg-gray-900 flex items-center justify-center py-20">
  <div class="absolute inset-0 bg-gradient-to-br from-gray-900 via-black to-gray-800"></div>
  <div class="relative z-10 max-w-6xl mx-auto px-8">
    <div class="text-center mb-16">
      <h2 class="text-4xl md:text-6xl font-extrabold text-white mb-6">Most Promising <span class="text-orange-500">Esports Games</span></h2>
      <p class="text-xl text-gray-300 max-w-3xl mx-auto">Discover the games that are shaping the future of competitive gaming</p>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- Valorant -->
      <div class="bg-black/40 backdrop-blur-sm rounded-xl overflow-hidden hover:bg-black/60 transition duration-300 group">
        <div class="h-48 bg-gradient-to-br from-red-600 to-red-800 flex items-center justify-center">
          <video class="h-full w-auto rounded-md shadow-lg" src="{% static 'videos/valorant.mov' %}" autoplay loop muted playsinline></video>
        </div>
        <div class="p-6">
          <h3 class="text-2xl font-bold text-white mb-3">Valorant</h3>
          <p class="text-gray-300 mb-4">Tactical FPS that combines precise shooting with unique agent abilities</p>
          <div class="flex justify-between items-center">
            <span class="text-orange-500 font-semibold">Growing Fast</span>
            <div class="w-16 h-2 bg-gray-700 rounded-full">
              <div class="w-14 h-2 bg-orange-500 rounded-full"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- League of Legends -->
      <div class="bg-black/40 backdrop-blur-sm rounded-xl overflow-hidden hover:bg-black/60 transition duration-300 group">
        <div class="h-48 bg-gradient-to-br from-blue-600 to-blue-800 flex items-center justify-center">
          <video class="h-full w-auto rounded-md shadow-lg" src="{% static 'videos/lol.mov' %}" autoplay loop muted playsinline></video>
        </div>
        <div class="p-6">
          <h3 class="text-2xl font-bold text-white mb-3">League of Legends</h3>
          <p class="text-gray-300 mb-4">The king of MOBAs with the largest esports ecosystem worldwide</p>
          <div class="flex justify-between items-center">
            <span class="text-green-500 font-semibold">Established</span>
            <div class="w-16 h-2 bg-gray-700 rounded-full">
              <div class="w-full h-2 bg-green-500 rounded-full"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- CS2 -->
      <div class="bg-black/40 backdrop-blur-sm rounded-xl overflow-hidden hover:bg-black/60 transition duration-300 group">
        <div class="h-48 bg-gradient-to-br from-yellow-600 to-orange-600 flex items-center justify-center">
          <video class="h-full w-auto rounded-md shadow-lg" src="{% static 'videos/cs2.mov' %}" autoplay loop muted playsinline></video>
        </div>
        <div class="p-6">
          <h3 class="text-2xl font-bold text-white mb-3">Counter-Strike 2</h3>
          <p class="text-gray-300 mb-4">The evolution of the legendary tactical shooter with updated graphics</p>
          <div class="flex justify-between items-center">
            <span class="text-yellow-500 font-semibold">Rising</span>
            <div class="w-16 h-2 bg-gray-700 rounded-full">
              <div class="w-12 h-2 bg-yellow-500 rounded-full"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Apex Legends -->
      <div class="bg-black/40 backdrop-blur-sm rounded-xl overflow-hidden hover:bg-black/60 transition duration-300 group">
        <div class="h-48 bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center">
          <video class="h-full w-auto rounded-md shadow-lg" src="{% static 'videos/apex.mp4' %}" autoplay loop muted playsinline></video>
        </div>
        <div class="p-6">
          <h3 class="text-2xl font-bold text-white mb-3">Apex Legends</h3>
          <p class="text-gray-300 mb-4">Battle royale with unique legends and fast-paced tactical gameplay</p>
          <div class="flex justify-between items-center">
            <span class="text-purple-500 font-semibold">Competitive</span>
            <div class="w-16 h-2 bg-gray-700 rounded-full">
              <div class="w-10 h-2 bg-purple-500 rounded-full"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Rocket League -->
      <div class="bg-black/40 backdrop-blur-sm rounded-xl overflow-hidden hover:bg-black/60 transition duration-300 group">
        <div class="h-48 bg-gradient-to-br from-cyan-600 to-blue-600 flex items-center justify-center">
          <video class="h-full w-auto rounded-md shadow-lg" src="{% static 'videos/rl.mov' %}" autoplay loop muted playsinline></video>
        </div>
        <div class="p-6">
          <h3 class="text-2xl font-bold text-white mb-3">Rocket League</h3>
          <p class="text-gray-300 mb-4">Soccer meets racing in this unique and highly competitive sports game</p>
          <div class="flex justify-between items-center">
            <span class="text-cyan-500 font-semibold">Unique</span>
            <div class="w-16 h-2 bg-gray-700 rounded-full">
              <div class="w-11 h-2 bg-cyan-500 rounded-full"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Fortnite -->
      <div class="bg-black/40 backdrop-blur-sm rounded-xl overflow-hidden hover:bg-black/60 transition duration-300 group">
        <div class="h-48 bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center">
          <video class="h-full w-auto rounded-md shadow-lg" src="{% static 'videos/fortnite.mov' %}" autoplay loop muted playsinline></video>
        </div>
        <div class="p-6">
          <h3 class="text-2xl font-bold text-white mb-3">Fortnite</h3>
          <p class="text-gray-300 mb-4">Building-based battle royale with creative gameplay mechanics</p>
          <div class="flex justify-between items-center">
            <span class="text-indigo-500 font-semibold">Popular</span>
            <div class="w-16 h-2 bg-gray-700 rounded-full">
              <div class="w-13 h-2 bg-indigo-500 rounded-full"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
  // Floating X and O spawner
  (function(){
    const container = document.getElementById('floatingXs');
    if (!container) return;
    
    function spawnFloating() {
      const el = document.createElement('div');
      el.className = 'floating-x';
      
      // Randomly choose between X and O
      el.textContent = Math.random() > 0.5 ? '✕' : 'O';
      
  // Random position and animation (cover full viewport)
  const left = Math.random() * 100; // 0-100% from left
  const bottom = Math.random() * 80; // 0-80% from bottom
  const drift = -40 + Math.random() * 80; // -40px to +40px drift
  const rot = -180 + Math.random() * 360; // -180 to +180 degrees
  const duration = 3000 + Math.random() * 4000; // 3-7s duration

  el.style.setProperty('--drift', `${drift}px`);
  el.style.setProperty('--rot', `${rot}deg`);
  el.style.left = `${left}%`;
  el.style.bottom = `${bottom}%`;
  el.style.animationDuration = `${duration}ms`;
      
      container.appendChild(el);
      setTimeout(() => el.remove(), duration);
    }

    // Initial burst
    for (let i = 0; i < 10; i++) {
      setTimeout(spawnFloating, i * 200);
    }

    // Continuous spawning
    const interval = setInterval(spawnFloating, 900);

    // Pause when page hidden
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) clearInterval(interval);
    });

    // Expose start/stop helpers
    window.startFloatingXs = () => {
      for (let i = 0; i < 10; i++) setTimeout(spawnFloating, i * 200);
    };
  })();

  // Video and background handler
  (function(){
    const video = document.getElementById('heroVideo');
    const heroBg = document.getElementById('heroBg');
    const sideImage = document.getElementById('sideLongImage');
    const bgSection = document.getElementById('bg');
    if (!video || !heroBg || !sideImage || !bgSection) return;

    let videoEnded = false;
    let heroInView = false;

    function showOmen() {
      sideImage.classList.add('show');
      sideImage.classList.remove('hide-on-bg');
    }
    function hideOmen() {
      sideImage.classList.remove('show');
      sideImage.classList.add('hide-on-bg');
    }

    // IntersectionObserver for hero section
    const heroSection = document.querySelector('.relative.z-20.h-screen.flex.flex-col.justify-between');
    let observer = null;
    if (heroSection) {
      observer = new IntersectionObserver((entries) => {
        heroInView = entries[0].isIntersecting;
        if (videoEnded) {
          if (heroInView) {
            showOmen();
          } else {
            hideOmen();
          }
        }
      }, { threshold: 0.15 }); // 15% of hero section visible
      observer.observe(heroSection);
    }

    function handleOmenVisibility() {
      if (!videoEnded) {
        hideOmen();
        return;
      }
      if (heroInView) {
        showOmen();
      } else {
        hideOmen();
      }
    }

    function onVideoEndOrFallback() {
      heroBg.classList.remove('opacity-0');
      heroBg.classList.add('opacity-100');
      setTimeout(() => {
        video.pause();
        videoEnded = true;
        handleOmenVisibility();
      }, 500);
    }

    video.addEventListener('ended', onVideoEndOrFallback);
    // Autoplay fallback
    setTimeout(() => {
      if (video.paused && !videoEnded) {
        onVideoEndOrFallback();
      }
    }, 8000);

    // Initial check
    handleOmenVisibility();
  })();
</script>
<script>
  // Hide omen.png when scrolling down
  (function(){
    const sideImage = document.getElementById('sideLongImage');
    if (!sideImage) return;

    let ticking = false;
    
    function handleScroll() {
      const scrollY = window.scrollY;
      const triggerPoint = window.innerHeight * 0.15; // Hide when scrolled 15% of viewport
      
      if (sideImage.classList.contains('show')) {
        if (scrollY > triggerPoint) {
          sideImage.classList.add('hide-on-scroll');
        } else {
          sideImage.classList.remove('hide-on-scroll');
        }
      }
      
      ticking = false;
    }
    
    function requestTick() {
      if (!ticking) {
        requestAnimationFrame(handleScroll);
        ticking = true;
      }
    }
    
    window.addEventListener('scroll', requestTick, { passive: true });
    
    // Initial check in case page loads already scrolled
    handleScroll();
  })();
</script>
{% endblock %}
